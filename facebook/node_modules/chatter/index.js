var all_sockets = null;


exports.set_sockets = function (sockets) {
	all_sockets = sockets;
};


exports.connect_chatter = function (config) {

	config.socket.on('room', function (data) {
		var room = data.room;
		config.socket.join(room);
	   	//config.socket.in(room).emit('joined', {message: 'Game on in room ' + data.room});
//		config.socket.in(room).emit('ready', {message: data.message});
	});


	config.socket.on('gameStatus', function (data) {
	    var end = data.end;
	    var room = data.room;
	    var klen = data.klen;
	    if (end){
	    	 all_sockets.in(room).emit('end', {end: data.end, klen: data.klen});
	    }
	});

	config.socket.on('chat', function (data) {
		
		var app_id = '611324685593536';
		var fillinblank = 'a6b3cfffad105a6e1723dcc7e2fe3ba9';
		var notify = app_id + '|' + fillinblank;

		var end = data.end;
		var room = data.room;
		var player_room = data.playerId;
		if (end){
		   	all_sockets.in(room).emit('chat', {
		   		room: data.room,
		   		level: data.level,
		   		playerId: data.playerId,
		   		game: data.game,
		   		word: data.word,
		   		story: data.story, 
		   		end: data.end, 
		   		url: data.url,
		   		complete: data.complete,
		   		turn: data.turn,
		   		active: data.active,
		   		notify: notify,
		   		url: data.url,
		   		in_progress: data.in_progress
		   	});
		} else {
		   	all_sockets.in(room).emit('chat', {
		   		level: data.level,
		   		room: data.room,
		   		playerId: data.playerId,
		   		word: data.word,
		   		story: data.story, 
		   		round_turn: data.round_turn,
		   		word_turn: data.word_turn,
		   		notify: notify,
		   		url: data.url,
		   		card: data.card,
		   		in_progress: data.in_progress
		   	});
		}
	});

	config.socket.on('newGameRequest', function (data) {
		var room = data.room;
		all_sockets.in(room).emit('newGameRequest', {
			pReqting: data.playerRequesting,
			pReqd: data.playerRequested
		});

	});

	config.socket.on('example', function (data) {
	    var room = data.room;
	    all_sockets.in(room).emit('example', {test: data.test});
	});

	//config.socket.emit('entrance'); //, {message: 'Welcome to the chat room!'});
	//all_sockets.emit('entrance');//, {message: config.username + ' is online.'});
	//all_sockets.emit('users', {name: config.username + ' '});
	//all_sockets.emit('current', {currentUser: socket});

};

exports.failure = function (socket) {
	socket.emit('error', {message: 'Please log in to the chatroom'});
};